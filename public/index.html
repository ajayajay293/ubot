<!DOCTYPE html>
<html lang="id">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Telegram Userbot Login</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       :root {
           --tg-blue: #0088cc;
           --tg-dark: #17212b;
           --tg-gray: #242f3d;
           --tg-light: #f5f5f5;
           --tg-white: #ffffff;
           --tg-gradient: linear-gradient(135deg, #0088cc 0%, #00a8e8 100%);
       }

       body {
           font-family: 'Inter', sans-serif;
           background: var(--tg-dark);
           min-height: 100vh;
           display: flex;
           align-items: center;
           justify-content: center;
           overflow-x: hidden;
           position: relative;
       }

       /* Animated Background */
       .bg-animation {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           z-index: -1;
           background: 
               radial-gradient(circle at 20% 80%, rgba(0, 136, 204, 0.15) 0%, transparent 50%),
               radial-gradient(circle at 80% 20%, rgba(0, 168, 232, 0.1) 0%, transparent 50%),
               radial-gradient(circle at 40% 40%, rgba(0, 136, 204, 0.05) 0%, transparent 30%);
       }

       .floating-shapes {
           position: fixed;
           width: 100%;
           height: 100%;
           overflow: hidden;
           z-index: -1;
           pointer-events: none;
       }

       .shape {
           position: absolute;
           opacity: 0.1;
           animation: float 20s infinite ease-in-out;
       }

       .shape:nth-child(1) {
           top: 10%;
           left: 10%;
           width: 80px;
           height: 80px;
           background: var(--tg-blue);
           border-radius: 50%;
           animation-delay: 0s;
       }

       .shape:nth-child(2) {
           top: 70%;
           right: 10%;
           width: 120px;
           height: 120px;
           background: var(--tg-blue);
           clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
           animation-delay: 5s;
       }

       .shape:nth-child(3) {
           bottom: 10%;
           left: 30%;
           width: 60px;
           height: 60px;
           border: 3px solid var(--tg-blue);
           border-radius: 50%;
           animation-delay: 10s;
       }

       @keyframes float {
           0%, 100% { transform: translateY(0) rotate(0deg); }
           33% { transform: translateY(-30px) rotate(120deg); }
           66% { transform: translateY(30px) rotate(240deg); }
       }

       /* Main Container */
       .container {
           width: 100%;
           max-width: 420px;
           padding: 20px;
           perspective: 1000px;
       }

       .login-card {
           background: rgba(36, 47, 61, 0.95);
           backdrop-filter: blur(20px);
           border-radius: 24px;
           padding: 40px 30px;
           box-shadow: 
               0 25px 50px -12px rgba(0, 0, 0, 0.5),
               0 0 0 1px rgba(255, 255, 255, 0.05);
           transform-style: preserve-3d;
           animation: cardEntry 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
           position: relative;
           overflow: hidden;
       }

       .login-card::before {
           content: '';
           position: absolute;
           top: 0;
           left: -100%;
           width: 100%;
           height: 2px;
           background: linear-gradient(90deg, transparent, var(--tg-blue), transparent);
           animation: scanline 3s linear infinite;
       }

       @keyframes scanline {
           0% { left: -100%; }
           100% { left: 100%; }
       }

       @keyframes cardEntry {
           0% {
               opacity: 0;
               transform: translateY(50px) rotateX(-15deg);
           }
           100% {
               opacity: 1;
               transform: translateY(0) rotateX(0);
           }
       }

       /* Logo Section */
       .logo-container {
           text-align: center;
           margin-bottom: 30px;
           position: relative;
       }

       .logo-wrapper {
           position: relative;
           display: inline-block;
           width: 100px;
           height: 100px;
       }

       .logo-bg {
           position: absolute;
           inset: 0;
           background: var(--tg-gradient);
           border-radius: 50%;
           filter: blur(20px);
           opacity: 0.4;
           animation: pulse 2s ease-in-out infinite;
       }

       @keyframes pulse {
           0%, 100% { transform: scale(1); opacity: 0.4; }
           50% { transform: scale(1.1); opacity: 0.6; }
       }

       .logo {
           position: relative;
           width: 100%;
           height: 100%;
           background: var(--tg-gradient);
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           box-shadow: 
               0 10px 40px rgba(0, 136, 204, 0.4),
               inset 0 2px 10px rgba(255, 255, 255, 0.2);
           animation: logoFloat 3s ease-in-out infinite;
       }

       @keyframes logoFloat {
           0%, 100% { transform: translateY(0); }
           50% { transform: translateY(-10px); }
       }

       .logo svg {
           width: 50px;
           height: 50px;
           fill: white;
           filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
           animation: paperPlane 2s ease-in-out infinite;
       }

       @keyframes paperPlane {
           0%, 100% { transform: translateX(0) translateY(0); }
           25% { transform: translateX(2px) translateY(-2px); }
           75% { transform: translateX(-2px) translateY(2px); }
       }

       .brand-name {
           margin-top: 20px;
           font-size: 28px;
           font-weight: 700;
           background: linear-gradient(135deg, #fff 0%, #8ec5ff 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           background-clip: text;
           letter-spacing: -0.5px;
       }

       .brand-subtitle {
           color: rgba(255, 255, 255, 0.5);
           font-size: 14px;
           margin-top: 5px;
           font-weight: 400;
       }

       /* Form Styles */
       .form-container {
           margin-top: 30px;
       }

       .input-group {
           margin-bottom: 20px;
           position: relative;
           opacity: 0;
           transform: translateY(20px);
           animation: slideUp 0.5s forwards;
       }

       .input-group:nth-child(1) { animation-delay: 0.2s; }
       .input-group:nth-child(2) { animation-delay: 0.3s; }
       .input-group:nth-child(3) { animation-delay: 0.4s; }

       @keyframes slideUp {
           to {
               opacity: 1;
               transform: translateY(0);
           }
       }

       .input-label {
           display: block;
           color: rgba(255, 255, 255, 0.7);
           font-size: 13px;
           font-weight: 500;
           margin-bottom: 8px;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .input-wrapper {
           position: relative;
       }

       .input-field {
           width: 100%;
           padding: 16px 20px;
           background: rgba(23, 33, 43, 0.8);
           border: 2px solid rgba(255, 255, 255, 0.1);
           border-radius: 12px;
           color: white;
           font-size: 16px;
           font-family: 'Inter', sans-serif;
           transition: all 0.3s ease;
           outline: none;
       }

       .input-field:focus {
           border-color: var(--tg-blue);
           background: rgba(23, 33, 43, 1);
           box-shadow: 0 0 0 4px rgba(0, 136, 204, 0.1);
       }

       .input-field::placeholder {
           color: rgba(255, 255, 255, 0.3);
       }

       .input-icon {
           position: absolute;
           right: 16px;
           top: 50%;
           transform: translateY(-50%);
           color: rgba(255, 255, 255, 0.4);
           font-size: 20px;
       }

       /* Button Styles */
       .btn {
           width: 100%;
           padding: 16px;
           background: var(--tg-gradient);
           border: none;
           border-radius: 12px;
           color: white;
           font-size: 16px;
           font-weight: 600;
           font-family: 'Inter', sans-serif;
           cursor: pointer;
           position: relative;
           overflow: hidden;
           transition: all 0.3s ease;
           text-transform: uppercase;
           letter-spacing: 1px;
           margin-top: 10px;
           opacity: 0;
           animation: slideUp 0.5s 0.5s forwards;
       }

       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 30px rgba(0, 136, 204, 0.4);
       }

       .btn:active {
           transform: translateY(0);
       }

       .btn::before {
           content: '';
           position: absolute;
           top: 0;
           left: -100%;
           width: 100%;
           height: 100%;
           background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
           transition: 0.5s;
       }

       .btn:hover::before {
           left: 100%;
       }

       .btn:disabled {
           opacity: 0.6;
           cursor: not-allowed;
           transform: none;
       }

       .btn-loading {
           display: none;
       }

       .btn.loading .btn-text {
           display: none;
       }

       .btn.loading .btn-loading {
           display: inline-flex;
           align-items: center;
           gap: 10px;
       }

       .spinner {
           width: 20px;
           height: 20px;
           border: 2px solid rgba(255,255,255,0.3);
           border-top-color: white;
           border-radius: 50%;
           animation: spin 0.8s linear infinite;
       }

       @keyframes spin {
           to { transform: rotate(360deg); }
       }

       /* Step Indicator */
       .steps {
           display: flex;
           justify-content: center;
           gap: 20px;
           margin-bottom: 30px;
           opacity: 0;
           animation: fadeIn 0.5s 0.1s forwards;
       }

       @keyframes fadeIn {
           to { opacity: 1; }
       }

       .step {
           display: flex;
           flex-direction: column;
           align-items: center;
           gap: 8px;
           position: relative;
       }

       .step:not(:last-child)::after {
           content: '';
           position: absolute;
           top: 15px;
           right: -25px;
           width: 30px;
           height: 2px;
           background: rgba(255,255,255,0.1);
       }

       .step-number {
           width: 32px;
           height: 32px;
           border-radius: 50%;
           background: rgba(255,255,255,0.1);
           display: flex;
           align-items: center;
           justify-content: center;
           font-weight: 600;
           font-size: 14px;
           color: rgba(255,255,255,0.5);
           transition: all 0.3s ease;
           border: 2px solid transparent;
       }

       .step.active .step-number {
           background: var(--tg-gradient);
           color: white;
           box-shadow: 0 0 20px rgba(0, 136, 204, 0.5);
       }

       .step.completed .step-number {
           background: #00c853;
           color: white;
       }

       .step-label {
           font-size: 12px;
           color: rgba(255,255,255,0.5);
           font-weight: 500;
       }

       .step.active .step-label {
           color: var(--tg-blue);
       }

       /* Message/Alert */
       .alert {
           padding: 12px 16px;
           border-radius: 8px;
           margin-bottom: 20px;
           font-size: 14px;
           display: none;
           align-items: center;
           gap: 10px;
           animation: shake 0.5s;
       }

       @keyframes shake {
           0%, 100% { transform: translateX(0); }
           25% { transform: translateX(-10px); }
           75% { transform: translateX(10px); }
       }

       .alert.show {
           display: flex;
       }

       .alert-error {
           background: rgba(255, 71, 87, 0.1);
           border: 1px solid rgba(255, 71, 87, 0.3);
           color: #ff4757;
       }

       .alert-success {
           background: rgba(0, 200, 83, 0.1);
           border: 1px solid rgba(0, 200, 83, 0.3);
           color: #00c853;
       }

       .alert-info {
           background: rgba(0, 136, 204, 0.1);
           border: 1px solid rgba(0, 136, 204, 0.3);
           color: var(--tg-blue);
       }

       /* Hidden sections */
       .section {
           display: none;
       }

       .section.active {
           display: block;
           animation: fadeIn 0.4s ease;
       }

       /* Phone prefix */
       .phone-prefix {
           position: absolute;
           left: 16px;
           top: 50%;
           transform: translateY(-50%);
           color: rgba(255,255,255,0.6);
           font-weight: 600;
           pointer-events: none;
       }

       .input-field.phone {
           padding-left: 50px;
       }

       /* Success Animation */
       .success-checkmark {
           width: 80px;
           height: 80px;
           border-radius: 50%;
           background: #00c853;
           display: none;
           align-items: center;
           justify-content: center;
           margin: 0 auto 20px;
           animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
       }

       .success-checkmark.show {
           display: flex;
       }

       @keyframes scaleIn {
           0% { transform: scale(0); }
           100% { transform: scale(1); }
       }

       .checkmark {
           width: 40px;
           height: 40px;
           stroke: white;
           stroke-width: 3;
           stroke-linecap: round;
           stroke-linejoin: round;
           fill: none;
           stroke-dasharray: 100;
           stroke-dashoffset: 100;
           animation: drawCheck 0.5s 0.2s forwards;
       }

       @keyframes drawCheck {
           to { stroke-dashoffset: 0; }
       }

       /* Footer */
       .footer {
           text-align: center;
           margin-top: 30px;
           color: rgba(255,255,255,0.4);
           font-size: 12px;
           opacity: 0;
           animation: fadeIn 0.5s 0.6s forwards;
       }

       .footer a {
           color: var(--tg-blue);
           text-decoration: none;
           font-weight: 500;
       }

       /* Responsive */
       @media (max-width: 480px) {
           .login-card {
               padding: 30px 20px;
               border-radius: 20px;
           }
           
           .logo-wrapper {
               width: 80px;
               height: 80px;
           }
           
           .brand-name {
               font-size: 24px;
           }
       }

       /* Input number arrows removal */
       input[type=number]::-webkit-inner-spin-button, 
       input[type=number]::-webkit-outer-spin-button { 
           -webkit-appearance: none; 
           margin: 0; 
       }
   </style>
</head>
<body>
   <div class="bg-animation"></div>
   <div class="floating-shapes">
       <div class="shape"></div>
       <div class="shape"></div>
       <div class="shape"></div>
   </div>

   <div class="container">
       <div class="login-card">
           <div class="logo-container">
               <div class="logo-wrapper">
                   <div class="logo-bg"></div>
                   <div class="logo">
                       <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                           <path d="M1.5 12.5L5.5 16.5L23.5 4.5L8.5 20.5L1.5 12.5Z"/>
                           <path d="M5.5 16.5L8.5 20.5L10.5 13.5L23.5 4.5L5.5 16.5Z" opacity="0.6"/>
                       </svg>
                   </div>
               </div>
               <h1 class="brand-name">Telegram Login</h1>
               <p class="brand-subtitle">Userbot Authentication System</p>
           </div>

           <div class="steps">
               <div class="step active" id="step1-indicator">
                   <div class="step-number">1</div>
                   <span class="step-label">Nomor</span>
               </div>
               <div class="step" id="step2-indicator">
                   <div class="step-number">2</div>
                   <span class="step-label">Kode OTP</span>
               </div>
               <div class="step" id="step3-indicator">
                   <div class="step-number">3</div>
                   <span class="step-label">Selesai</span>
               </div>
           </div>

           <div id="alert" class="alert">
               <span id="alert-message"></span>
           </div>

           <!-- Step 1: Phone Number -->
           <div id="step1" class="section active">
               <div class="form-container">
                   <div class="input-group">
                       <label class="input-label">Nomor Telepon</label>
                       <div class="input-wrapper">
                           <span class="phone-prefix">+62</span>
                           <input type="tel" 
                                  class="input-field phone" 
                                  id="phoneNumber" 
                                  placeholder="81234567890"
                                  maxlength="13"
                                  autocomplete="off">
                       </div>
                   </div>
                   <button class="btn" id="btnSendCode" onclick="sendCode()">
                       <span class="btn-text">Kirim Kode OTP</span>
                       <span class="btn-loading">
                           <div class="spinner"></div>
                           <span>Mengirim...</span>
                       </span>
                   </button>
               </div>
           </div>

           <!-- Step 2: OTP Code -->
           <div id="step2" class="section">
               <div class="form-container">
                   <div class="input-group">
                       <label class="input-label">Kode OTP</label>
                       <div class="input-wrapper">
                           <input type="number" 
                                  class="input-field" 
                                  id="otpCode" 
                                  placeholder="12345"
                                  maxlength="5"
                                  oninput="if(this.value.length > 5) this.value = this.value.slice(0,5)">
                       </div>
                   </div>
                   <div class="input-group" id="passwordGroup" style="display: none;">
                       <label class="input-label">Password 2FA (jika ada)</label>
                       <div class="input-wrapper">
                           <input type="password" 
                                  class="input-field" 
                                  id="password" 
                                  placeholder="Password cloud password">
                       </div>
                   </div>
                   <button class="btn" id="btnVerify" onclick="verifyCode()">
                       <span class="btn-text">Verifikasi</span>
                       <span class="btn-loading">
                           <div class="spinner"></div>
                           <span>Memverifikasi...</span>
                       </span>
                   </button>
                   <button class="btn" style="background: transparent; border: 2px solid rgba(255,255,255,0.1); margin-top: 10px;" onclick="backToStep1()">
                       <span class="btn-text">Kembali</span>
                   </button>
               </div>
           </div>

           <!-- Step 3: Success -->
           <div id="step3" class="section">
               <div class="success-checkmark" id="successCheck">
                   <svg class="checkmark" viewBox="0 0 52 52">
                       <path d="M14 27 L22 35 L38 16"></path>
                   </svg>
               </div>
               <div style="text-align: center; color: white;">
                   <h2 style="margin-bottom: 10px; font-size: 24px;">Login Berhasil!</h2>
                   <p style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px;">
                       Anda akan dialihkan ke halaman utama...
                   </p>
               </div>
           </div>

           <div class="footer">
               <p>Powered by <a href="https://telegram.org" target="_blank">Telegram API</a></p>
               <p style="margin-top: 5px; font-size: 11px;">Secure & Encrypted</p>
           </div>
       </div>
   </div>

   <script>
       // API Configuration
       const API_BASE = window.location.origin;
       
       let currentStep = 1;
       let sessionData = null;

       // Utility Functions
       function showAlert(message, type = 'error') {
           const alert = document.getElementById('alert');
           const alertMessage = document.getElementById('alert-message');
           
           alert.className = `alert alert-${type} show`;
           alertMessage.textContent = message;
           
           setTimeout(() => {
               alert.classList.remove('show');
           }, 5000);
       }

       function setLoading(buttonId, loading) {
           const btn = document.getElementById(buttonId);
           if (loading) {
               btn.classList.add('loading');
               btn.disabled = true;
           } else {
               btn.classList.remove('loading');
               btn.disabled = false;
           }
       }

       function goToStep(step) {
           // Hide all sections
           document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
           
           // Update indicators
           document.querySelectorAll('.step').forEach((s, index) => {
               s.classList.remove('active', 'completed');
               if (index + 1 < step) s.classList.add('completed');
               if (index + 1 === step) s.classList.add('active');
           });
           
           // Show target section
           document.getElementById(`step${step}`).classList.add('active');
           currentStep = step;
           
           // Auto focus input
           setTimeout(() => {
               const input = document.querySelector(`#step${step} input`);
               if (input) input.focus();
           }, 100);
       }

       // Step 1: Send Code
       async function sendCode() {
           const phoneInput = document.getElementById('phoneNumber');
           let phone = phoneInput.value.trim();
           
           // Format phone number
           if (phone.startsWith('0')) {
               phone = '62' + phone.substring(1);
           } else if (!phone.startsWith('62')) {
               phone = '62' + phone;
           }
           
           if (phone.length < 10) {
               showAlert('Nomor telepon tidak valid');
               phoneInput.focus();
               return;
           }
           
           setLoading('btnSendCode', true);
           
           try {
               const response = await fetch(`${API_BASE}/api/send-code`, {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({ phoneNumber: '+' + phone })
               });
               
               const data = await response.json();
               
               if (data.success) {
                   sessionData = data.sessionId;
                   showAlert('Kode OTP telah dikirim ke Telegram Anda', 'success');
                   goToStep(2);
               } else {
                   showAlert(data.error || 'Gagal mengirim kode');
               }
           } catch (error) {
               showAlert('Terjadi kesalahan koneksi');
               console.error(error);
           } finally {
               setLoading('btnSendCode', false);
           }
       }

       // Step 2: Verify Code
       async function verifyCode() {
           const code = document.getElementById('otpCode').value.trim();
           const password = document.getElementById('password').value.trim();
           
           if (code.length !== 5) {
               showAlert('Kode OTP harus 5 digit');
               return;
           }
           
           setLoading('btnVerify', true);
           
           try {
               const response = await fetch(`${API_BASE}/api/verify-code`, {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({ 
                       code: code,
                       password: password || undefined
                   }),
                   credentials: 'include'
               });
               
               const data = await response.json();
               
               if (data.success) {
                   showAlert('Verifikasi berhasil!', 'success');
                   document.getElementById('successCheck').classList.add('show');
                   goToStep(3);
                   
                   // Redirect to home after 2 seconds
                   setTimeout(() => {
                       window.location.href = '/home';
                   }, 2000);
               } else {
                   if (data.requirePassword) {
                       document.getElementById('passwordGroup').style.display = 'block';
                       showAlert('Akun Anda memiliki 2FA aktif. Silakan masukkan password.', 'info');
                   } else {
                       showAlert(data.error || 'Kode OTP salah');
                   }
               }
           } catch (error) {
               showAlert('Terjadi kesalahan koneksi');
               console.error(error);
           } finally {
               setLoading('btnVerify', false);
           }
       }

       function backToStep1() {
           goToStep(1);
           document.getElementById('otpCode').value = '';
           document.getElementById('password').value = '';
           document.getElementById('passwordGroup').style.display = 'none';
       }

       // Enter key support
       document.getElementById('phoneNumber').addEventListener('keypress', (e) => {
           if (e.key === 'Enter') sendCode();
       });

       document.getElementById('otpCode').addEventListener('keypress', (e) => {
           if (e.key === 'Enter') verifyCode();
       });

       document.getElementById('password').addEventListener('keypress', (e) => {
           if (e.key === 'Enter') verifyCode();
       });

       // Phone input formatting
       document.getElementById('phoneNumber').addEventListener('input', (e) => {
           e.target.value = e.target.value.replace(/\D/g, '');
       });
   </script>
</body>
</html>
